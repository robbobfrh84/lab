<!doctype html>
<head>
  <meta charset="utf-8">
  <title>Camp Features</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
  </script>
</head>
<body>
  <div>
    <img class='left-nav' src="left.png">
    <img class='right-nav' src="right.png">
    <div class="nav-bar"></div>
  </div>
  <br>
  <div class='site-name'>
    Big Lake Camp
  </div>
  <div class="host-info">
    <div class='icon-box'>
      <img class='bob' src="bob.png">
    </div>
    <div class='host-name'>
      <strong class='bold'> Hosted By </strong> <br> Bob
    </div>
    <div class='summery'> <br> &nbsp; &nbsp; &nbsp; &nbsp;
      Nestled in the beautiful Fall River Valley, this beautiful land overlooks farms and hillsides. There is ample hiking, biking, fishing and hunting. Donâ€™t miss the beautiful moonlight canoe ride on Lake Ahjumawi or drinks at the Buckhorn saloon!
    </div>
  </div>
  <div class='features-box'>
    <ul id='show-features' class='ul-box'>
      <!-- <li onclick='showSubF()' name="Toilet" class='feature'>
        <span class="check"> &#10003; </span>
        Toilets
        <div class="plus-minus-toggle plus"> </div>
      </li>
      <li onclick='showSubF()' name="Pets allowed" class='feature'>
        <span class="check"> &#10003; </span>
        Pets Allowed
        <div class="plus-minus-toggle plus"></div>
      </li>
      <li onclick='showSubF()' name="Shower" class='feature'>
        <span class="check"> &#10003; </span>
        Shower
        <div class="plus-minus-toggle plus"> </div>
      </li>
      <li onclick='showSubF()' name="Trash" class='feature'>
        <span class="check"> &#10003; </span>
        Trash
        <div class="plus-minus-toggle plus"> </div>
      </li> -->
    </ul>
  </div>
</body>
<script src="camp_features.js"></script>
<script>

  showSubF = (title)=>{
    // const title = event.path[0].getAttribute('name')
    const feature = FEATURES.filter((x)=>{ return title === x.title })[0]
    const parent = event.path[0].nextElementSibling
    // const parent = event.path[0]
    let status = '<span class="check"> &#10003; </span>'
    displaySubFeatures = (feature, parent)=>{
      const ul_node = document.createElement('ul')
      event.path[1].insertBefore(ul_node, parent)
      for (subfeature of feature.subfeatures) {
        const node = document.createElement('li')
        const textnode = document.createTextNode(subfeature.title)
        if (!subfeature.presence) {
          node.className += ' no-presence'
          status = '<span class="x2"> &#10005; </span>'
          node.innerHTML += '<span class="x2"> &#10005; </span>'+node.innerHTML
        }
        if (subfeature.subfeatures.length) {
          node.className += ' pointer'
          node.innerHTML = status+'<div class="plus-minus-toggle plus show"> </div>'
          const passObj = subfeature
          node.className += ' ul-feature'
          node.addEventListener('click', ()=>{
            if (!subfeature.open) displaySubFeatures(passObj, node.nextElementSibling)
            else ul_node.removeChild(node.nextElementSibling);
            if (!subfeature.open) node.children[1].className = 'plus-minus-toggle show'
            else node.children[1].className = 'plus-minus-toggle plus show'
            subfeature.open = !subfeature.open
          })
        }
        if (subfeature.presence) {
          node.innerHTML = '<span class="check"> &#10003; </span>'+node.innerHTML
        }
        node.appendChild(textnode)
        ul_node.appendChild(node)
      }
    }
    if (feature.subfeatures.length) {
      if (!feature.open) event.path[0].children[1].className = 'plus-minus-toggle show'
      else event.path[0].children[1].className = 'plus-minus-toggle plus show'
    }
    if (!feature.open) displaySubFeatures(feature, parent)
    else while (parent.hasChildNodes()) { parent.removeChild(parent.lastChild) }
    feature.open = !feature.open
    if (subfeature.open) subfeature.open = !subfeature.open
  }

  window.onload = ()=>{
    let showFeatures = document.getElementById('show-features')

    for (feature of FEATURES) {
      var li = document.createElement('li') // creat new <li> tag for feature
      // if the feature is not-presence show "x"-icon and give no-presence class
      if (!feature.presence) {
        li.className += 'feature no-presence'
        li.innerHTML = '<span class="x"> &#10005; </span> '+feature.title
      } else {
        li.className += 'feature'
        li.innerHTML = '<span class="check"> &#10003; </span> '+feature.title
      }
      // feature has subfeature, give pointer class to idicate clickable
      if (feature.subfeatures.length) {
        //     featureTag.children[1].className += ' show'
        li.className += ' pointer'
        li.innerHTML += '<div class="plus-minus-toggle plus show"> </div>'
        const title = feature.title
        li.addEventListener('click', ()=>{ showSubF(title) })
      }
      showFeatures.appendChild(li) // add feature <li> to parent <ul>

      // showFeatures.innerHTML += '<li onclick="showSubF()" name="Toilet" class="feature">'
      //   +'<span class="check"> &#10003; </span>'
      //   +feature.title+'<div class="plus-minus-toggle plus"> </div></li>'
    }
    // After dom is loaded (or api recieved) Change class for features that do not exist.
    // for (featureTag of document.getElementsByClassName('feature')) {
    //   console.log(featureTag)
    //   const feature = FEATURES.filter((x)=>{ return featureTag.getAttribute('name') === x.title })[0]
    //   if (!feature.presence) {
    //     featureTag.className += ' no-presence'
    //     featureTag.children[0].innerHTML = '<span class="x"> &#10005; </span> '+featureTag.children[1].innerHTML
    //   }
    //   if (feature.subfeatures.length) {
    //     featureTag.children[1].className += ' show'
    //     featureTag.className += ' pointer'
    //   }
    // }
    // hide initial state of features while api returns...
    showFeatures.style.display = 'block'
  }

</script>
</html>
