<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>!</title>
  <link rel="stylesheet" href="led.css">
</head>
<body>
  <div id='ledLine' ></div>
  <div class='cols' id='egG' onclick='newCol(egg,egG)' style='background-Color: rgb(240,234,214);'></div>
  <div class='cols' id='asH' onclick='newCol(ash,asH)' style='background-Color: rgb(32,32,32);'></div>
  <div class='cols' id='blU' onclick='newCol(blu,blU)' style='background-Color: cornflowerblue;'></div>
  <div class='cols' id='reD' onclick='newCol(red,reD)' style='background-Color: firebrick;'></div>
  <div class='cols' id='grE' onclick='newCol(gre,grE)' style='background-Color: green;'></div>

  </br>
  <div id='custCol' class='cols' onclick='newCol([r,g,b],custCol)'>
    <input id='redSlide' class='rgbSlide' type="range" min="0" max="255" step="1" value="0" oninput="rgbUpdate(value,'r','redVal','redSlide')">
    <input id='grnSlide' class='rgbSlide' type="range" min="0" max="255" step="1" value="0" oninput="rgbUpdate(value,'g','grnVal','grnSlide')">
    <input id='bluSlide' class='rgbSlide' type="range" min="0" max="255" step="1" value="0" oninput="rgbUpdate(value,'b','bluVal','bluSlide')">
  </div>
  <p>rgb: </p>
  <input id='redVal' class='custIn' value='0' oninput="rgbUpdate(value,'r','redVal','redSlide')">0</input><p>, </p>
  <input id='grnVal' class='custIn' value='0' oninput="rgbUpdate(value,'g','grnVal','grnSlide')">0</input><p>, </p>
  <input id='bluVal' class='custIn' value='0' oninput="rgbUpdate(value,'b','bluVal','bluSlide')">0</input>
  <br>
  <div id='dance' class='button' onclick="stopColorShuffle()" >Dance</div>
  <div id='blackOut' class='button' onclick="allColor(ash)" >All Black</div>
  <div id='blackOut' class='button' onclick="allColor(gre)" >All Green</div>

  <script src="http://cdn.pubnub.com/pubnub-3.7.15.min.js"></script>
  <script>
      var r=0; var g=0; var b=0;
      function rgbUpdate(val,col,input,slide) {
        if(col === 'r') { r = val; } if(col === 'g') { g = val; } if(col === 'b') { b = val; }
        document.getElementById(input).value = val;
        document.getElementById(slide).value = val;
        document.getElementById('custCol').style.backgroundColor = 'rgb('+r+','+g+','+b+')';
        publishUpdate({ledNum: 0, col: [r,g,b]});
      }

      var ash = [0,0,0];
      var egg = [200,200,200];
      var blu = [0,0,100];
      var red = [100,0,0];
      var gre = [0,100,0];

      var color = egg;

      var rows = 64; var blkClass = 'leds';
      for (var i = 0; i < rows; i++){
        var blk = document.createElement('div');
        if (i % 8 === 0){ ledLine.innerHTML += '<br>';}
        blk.className = blkClass; blk.id = 'blk'+i;
        blk.setAttribute('onmousedown', 'changeLed(blk'+i+','+i+')');
        ledLine.appendChild(blk);
      }

    	var settings = {
    		channel: 'hue-clone',
    		publish_key: 'pub-c-926e03e9-2cbb-4a3d-b17a-2ee47ca078a5',
    		subscribe_key: 'sub-c-b3fbc6fa-0bf5-11e6-a8fd-02ee2ddab7fe'
    	};

    	var pubnub = PUBNUB(settings);
    	function publishUpdate(data) {
    		pubnub.publish({
    			channel: settings.channel,
    			message: data
    		});
    	}

      function changeLed(Id,led){
        console.log(led,color);
        var swapCol = oldBtn.style.backgroundColor;
        Id.style.backgroundColor = swapCol;
        publishUpdate({ledNum: led, col: color});
      }

      var oldBtn = document.getElementById('egG');
      function newCol(newColor, btn){
        color=newColor;
        console.log(color);
        btn.style.boxShadow = '0 0 5px rgba(255,0,0,1)';
        oldBtn.style.boxShadow = ' 0 0 5px rgba(0,0,0,0.4)';
        oldBtn = btn;
      }

      function allColor(color){
        for ( var i = 0; i < rows; i++) {
          var blk = document.getElementById('blk'+i);
          blk.style.backgroundColor = 'rgb('+color[0]+','+color[1]+','+color[2]+')';
          publishUpdate({ledNum: i, col: color });
        }
      }

      function numberColorShuffle(number){
        for ( var i = 0; i < number; i++) {
          var bId = Math.floor(Math.random() * (rows))
          var blk = document.getElementById('blk'+bId)
          var randCol = [random(0,255),random(0,255),random(0,255)]
          blk.style.backgroundColor = 'rgb('+randCol[0]+','+randCol[1]+','+randCol[2]+')';
          console.log(blk);
          publishUpdate({ledNum: bId, col: randCol });
        }
      }

      var pauseResume = false; var ayter1;
      function stopColorShuffle() {
        if(pauseResume){ clearInterval(ayter1); pauseResume = false;
          dance.innerHTML = 'Dance'; dance.style.color = '#6495ed';
        } else { ayter1 = setInterval(function(){numberColorShuffle(2);}, 200);
          dance.innerHTML = 'STOP'; dance.style.color = '#daa520';
          pauseResume = true;
        }
      }

      function random(min, max) {
        return Math.floor(Math.random() * (max - min + 1) + min);
      }

      //allColor(blk);

	</script>
</body>
</html>
