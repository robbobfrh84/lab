<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
	  #container{
		margin-left:auto;
		margin-right:auto;
		width:470px;
	  }
	  #apples{
		color: #008000;
	   }
	   
	  #oranges{
		color: #ffa500;
	  }
	  h2{
	    text-align:center;
	  }
      #myCanvas {
        border: 2px dashed grey;
      }
    </style>
	<script src="/socket.io/socket.io.js"></script>
    <script>
	  // canvas request for all browsers
	  window.requestAnimFrame = (function(callback) {
        return window.requestAnimationFrame || 
        window.webkitRequestAnimationFrame || 
        window.mozRequestAnimationFrame || 
        window.oRequestAnimationFrame || 
        window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback, 1000 / 30); // 30 frames per second
        };
      })();
	  
	  var iosocket;
	  var pollOneH = 0;
	  var pollOneNew = 0;
	  var poll1;
	  var poll2;
	  var pollTwoH = 0;
	  var maxHeight = 480;
	  var changePollOne = false;
	  
	  function animation(poll1,poll2)
	  {
	    var canvas = document.getElementById("myCanvas");
        var graph1 = canvas.getContext("2d");
			
		// clear stage
		graph1.clearRect(0, 0, 460, 500);

        // render stage
		graph1.fillStyle = 'green';
		graph1.fillRect(poll1.x,(poll1.y-poll1.h),poll1.w,poll1.h);
				
		graph1.fillStyle = 'orange';
		graph1.fillRect(poll2.x,(poll2.y-poll2.h),poll2.w,poll2.h);
		
		graph1.fill();

        // request new frame
        requestAnimFrame(function() {
		  if(poll1.h < pollOneH * maxHeight){
			 poll1.h += .5;
		  }
		  else if(poll1.h > pollOneH * maxHeight){
			 poll1.h -= .5;
		  }
		  if(poll2.h < pollTwoH * maxHeight){
			 poll2.h += .5;
		  }
		  else if(poll2.h > pollTwoH * maxHeight){
			 poll2.h -= .5;
		  }
		animation(poll1,poll2);
        });
	  }
	  
	  function initSocketIO()
	  {
		iosocket = io.connect();
			iosocket.on('onconnection', function(value) {
				pollOneH = JSON.stringify(value.pollOneValue); // recieve start poll value from server
				pollTwoH = JSON.stringify(value.pollTwoValue);
				initPoll();
				
				// recieve changed values by other client from server
				iosocket.on('updateData', function (recievedData) {
					pollOneH = JSON.stringify(recievedData.pollOneValue); // recieve start poll value from server
					pollTwoH = JSON.stringify(recievedData.pollTwoValue);
					console.log(recievedData);
				});
			});
	  }
	  
	  function initPoll()
	  {
	  	poll1 = {
				x: 10,
				y: 500,
				w: 200,
				h: 0
		}
		var poll2 = {
				x: 250,
				y: 500,
				w: 200,
				h: 0
		}
		animation(poll1,poll2);
	  }
	
      window.onload = function() {
			initSocketIO();
      };
    </script>
  </head>
  <body>
   <div id="container">
	<h2>Comparing <b id="apples">apples</b> to <b id="oranges">oranges</b></h2>
    <canvas id="myCanvas" width="460" height="500"></canvas>
   </div>
  </body>
</html>