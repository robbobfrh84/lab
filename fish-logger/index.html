<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Create a draggable point</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.52.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        body { margin:0; padding:0; }
        #map { position:absolute; top:0; bottom:0; width:100%; }
    </style>
</head>
<body>


<style>
.coordinates {
    background: rgba(0,0,0,0.5);
    color: #fff;
    position: absolute;
    bottom: 10px;
    left: 10px;
    padding:5px 10px;
    margin: 0;
    font-size: 11px;
    line-height: 18px;
    border-radius: 3px;
    display: none;
}
</style>

<div id='map'></div>
<pre id='coordinates' class='coordinates'></pre>

<script>

  mapboxgl.accessToken = 'pk.eyJ1Ijoicm9iYm9iZnJoODQiLCJhIjoiY2pvamcyNXUzMDFiMDNwcnc2Z2dibm10ZCJ9.y7ll2wHKfb5WIwtAtK9eJA';
  var coordinates = document.getElementById('coordinates');
  var map = new mapboxgl.Map({
    container: 'map',
    // style: 'mapbox://styles/mapbox/streets-v9',
    style: 'mapbox://styles/mapbox/dark-v9',
    center: [-121.4316425272457, 41.095638225895186],
    zoom: 7
  });

  const fishes = [
    [-122.4316425272457, 41.095638225895186],
    [-122.8316425272457, 41.595638225895186],
    [-122.0316425272457, 40.995638225895186]
  ]
  // const fishImage = 'https://image.flaticon.com/icons/png/128/135/135677.png'
  const fishImage = 'bluefish.png'


  var canvas = map.getCanvasContainer();

  var geojson = {
    "type": "FeatureCollection",
    "features": [{
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [-121.4316425272457, 41.095638225895186]
      }
    }]
  };

  function onMove(e) {
    var coords = e.lngLat;
    canvas.style.cursor = 'grabbing';
    geojson.features[0].geometry.coordinates = [coords.lng, coords.lat];
    map.getSource('point').setData(geojson);
  }

  function onUp(e) {
    var coords = e.lngLat;
    coordinates.style.display = 'block';
    coordinates.innerHTML = 'Longitude: ' + coords.lng + '<br />Latitude: ' + coords.lat;
    canvas.style.cursor = '';
    map.off('mousemove', onMove);
    map.off('touchmove', onMove);
  }

  map.on('load', function() {

    map.loadImage(fishImage, function(error, image) {
      if (error) throw error;
      map.addImage('fish', image);

      for (var i = 0; i < fishes.length; i++) {
        map.addLayer({
          "id": "fish-"+i,
          "type": "symbol",
          "source": {
            "type": "geojson",
            "data": {
              "type": "FeatureCollection",
              "features": [{
                "type": "Feature",
                "geometry": {
                  "type": "Point",
                  "coordinates": fishes[i]
                }
              }]
            }
          },
          "layout": {
            "icon-image": "fish",
            "icon-size": 0.25
          }
        });
      }
    });





    map.addSource('point', {
      "type": "geojson",
      "data": geojson
    })

    map.addLayer({
      "id": "point",
      "type": "circle",
      "source": "point",
      "paint": {
        "circle-radius": 10,
        "circle-color": "#3887be"
      }
    })

    // When the cursor enters a feature in the point layer, prepare for dragging.
    map.on('mouseenter', 'point', function() {
      map.setPaintProperty('point', 'circle-color', '#3bb2d0');
      canvas.style.cursor = 'move';
    })

    map.on('mouseleave', 'point', function() {
      map.setPaintProperty('point', 'circle-color', '#3887be');
      canvas.style.cursor = '';
    })

    map.on('mousedown', 'point', function(e) {
      // Prevent the default map drag behavior.
      e.preventDefault()
      canvas.style.cursor = 'grab'
      map.on('mousemove', onMove)
      map.once('mouseup', onUp)
    })

    map.on('touchstart', 'point', function(e) {
      if (e.points.length !== 1) return;
      // Prevent the default map drag behavior.
      e.preventDefault();
      map.on('touchmove', onMove);
      map.once('touchend', onUp);
    });
  });
</script>

</body>
</html>
